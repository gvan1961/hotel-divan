<div class="jantar-container">
  <div class="header">
    <h2>ğŸ½ï¸ HÃ³spedes Autorizados - Jantar</h2>
    <button (click)="carregarApartamentos()" class="btn-atualizar">
      ğŸ”„ Atualizar
    </button>
  </div>

  <!-- BUSCA DE HÃ“SPEDE -->
<div class="busca-hospede">
  <h3>ğŸ” Buscar HÃ³spede</h3>
  <div class="busca-form">
  <input 
    type="text" 
    [(ngModel)]="nomeBusca" 
    placeholder="Nome do hÃ³spede (opcional)"
    class="input-busca">
  
  <input 
    type="text" 
    [(ngModel)]="apartamentoBusca" 
    placeholder="NÂº Apartamento (opcional)"
    class="input-busca-apto">
  
  <button (click)="buscar()" class="btn-buscar">
    ğŸ” Buscar
  </button>
  
  <button (click)="limparBusca()" class="btn-limpar">
    ğŸ—‘ï¸ Limpar
  </button>
</div>

  <!-- RESULTADO DA BUSCA -->
  <div *ngIf="resultadoBusca" class="resultado-busca">
    <div *ngIf="!resultadoBusca.encontrado" class="busca-nao-encontrado">
      âš ï¸ {{ resultadoBusca.mensagem }}
    </div>

    <div *ngIf="resultadoBusca.encontrado && resultadoBusca.hospedes" class="busca-encontrados">
      <h4>HÃ³spedes Encontrados:</h4>
      <div *ngFor="let hospede of resultadoBusca.hospedes" class="hospede-busca-item">
        <div class="hospede-busca-info">
          <div class="info-linha">
            <span class="nome-destaque">{{ hospede.nomeCompleto }}</span>
            <span *ngIf="hospede.titular" class="badge-titular">ğŸ‘‘ Titular</span>
          </div>
          <div class="info-linha">
            <span>ğŸ¢ Apartamento {{ hospede.numeroApartamento }}</span>
          </div>
          <div class="info-linha">
            <span *ngIf="hospede.autorizadoJantar" class="autorizado">
              âœ… AUTORIZADO - Pode lanÃ§ar no apartamento
            </span>
            <span *ngIf="!hospede.autorizadoJantar" class="nao-autorizado">
              âŒ NÃƒO AUTORIZADO - Somente Ã  vista
            </span>
          </div>
        </div>
        <button 
          *ngIf="hospede.autorizadoJantar"
          (click)="abrirModalComandaBusca(hospede)" 
          class="btn-comanda">
          ğŸ“ LanÃ§ar Comanda
        </button>
        <button 
          *ngIf="!hospede.autorizadoJantar"
          disabled
          class="btn-comanda-disabled">
          ğŸš« Pagamento Ã  Vista
        </button>
      </div>
    </div>
  </div>
</div>

<hr class="separador">

  <div *ngIf="loading" class="loading">
    Carregando...
  </div>

  <div *ngIf="erro" class="erro">
    {{ erro }}
  </div>

  <div *ngIf="!loading && apartamentos.length === 0" class="vazio">
    ğŸ˜´ Nenhum apartamento com hÃ³spedes autorizados
  </div>

  <div class="apartamentos-grid">
    <div *ngFor="let apto of apartamentos" class="apartamento-card">
      <div class="apartamento-header">
        <h3>ğŸ¢ Apartamento {{ apto.numeroApartamento }}</h3>
        <span class="badge">{{ apto.hospedes.length }} hÃ³spede(s)</span>
      </div>
      
      <div class="hospedes-lista">
        <div *ngFor="let hospede of apto.hospedes" class="hospede-item">
  <div class="hospede-info">
    <div class="hospede-dados">
      <span class="nome">{{ hospede.nomeCompleto }}</span>
      <span *ngIf="hospede.titular" class="titular">ğŸ‘‘ Titular</span>
    </div>
    <button (click)="abrirModalComanda(hospede, apto.numeroApartamento)" 
            class="btn-comanda">
      ğŸ“ LanÃ§ar Comanda
    </button>
  </div>
</div>
      </div>
    </div>
  </div>

  <!-- MODAL DE COMANDA -->
<div *ngIf="modalAberto" class="modal-overlay" (click)="fecharModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>ğŸ“ LanÃ§ar Comanda</h3>
      <button class="btn-fechar" (click)="fecharModal()">âœ•</button>
    </div>

    <div class="modal-body">
      <div class="info-hospede">
        <p><strong>ğŸ‘¤ HÃ³spede:</strong> {{ hospedeSelecionado?.nomeCompleto }}</p>
        <p><strong>ğŸ¢ Apartamento:</strong> {{ apartamentoSelecionado }}</p>
      </div>

      <!-- PRODUTOS DISPONÃVEIS -->
      <div class="produtos-section">
        <h4>Produtos do Restaurante:</h4>
        
        <div *ngIf="produtosCarregando" class="temp-message">
          â³ Carregando produtos...
        </div>

        <div *ngIf="!produtosCarregando" class="produtos-lista">
          <div *ngFor="let produto of produtos" class="produto-item">
            <div class="produto-info">
              <span class="produto-nome">{{ produto.nomeProduto }}</span>
              <span class="produto-preco">R$ {{ produto.valorVenda.toFixed(2) }}</span>
            </div>
            <button (click)="adicionarProduto(produto)" class="btn-adicionar">
              â• Adicionar
            </button>
          </div>
        </div>
      </div>

      <!-- PRODUTOS SELECIONADOS -->
      <div *ngIf="produtosSelecionados.length > 0" class="selecionados-section">
        <h4>Itens da Comanda:</h4>
        
        <div class="selecionados-lista">
          <div *ngFor="let item of produtosSelecionados; let i = index" class="item-selecionado">
            <div class="item-info">
              <span class="item-nome">{{ item.produto.nomeProduto }}</span>
              <div class="item-controles">
                <input 
                  type="number" 
                  [(ngModel)]="item.quantidade"
                  (change)="alterarQuantidade(i, item.quantidade)"
                  min="1"
                  class="input-quantidade">
                <span class="item-subtotal">
                  R$ {{ (item.produto.valorVenda * item.quantidade).toFixed(2) }}
                </span>
                <button (click)="removerProduto(i)" class="btn-remover">ğŸ—‘ï¸</button>
              </div>
            </div>
          </div>
        </div>

        <div class="total-section">
          <strong>TOTAL:</strong>
          <span class="total-valor">R$ {{ calcularTotal().toFixed(2) }}</span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-cancelar" (click)="fecharModal()">Cancelar</button>
      <button class="btn-confirmar" (click)="confirmarComanda()">
        Confirmar Comanda ({{ produtosSelecionados.length }} item(ns))
      </button>
    </div>
  </div>
</div>
</div>