<div class="abertura-caixa-container">
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- LOADING -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div *ngIf="carregando && !caixaAberto" class="loading-container">
    <div class="spinner"></div>
    <p>Verificando caixa...</p>
  </div>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- CAIXA J√Å ABERTO (SEM DUPLICAR!) -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div *ngIf="caixaAberto && !carregando" class="caixa-aberto-card">
    <div class="card-header caixa-aberto">
      <h2>‚úÖ CAIXA J√Å EST√Å ABERTO</h2>
    </div>
    
    <div class="card-body">
      <div class="info-grid">
        <div class="info-item">
          <span class="label">Caixa ID:</span>
          <span class="valor">#{{ caixaAtual?.id }}</span>
        </div>
        <div class="info-item">
          <span class="label">Turno:</span>
          <span class="valor">{{ caixaAtual?.turno }}</span>
        </div>
        <div class="info-item">
          <span class="label">Aberto em:</span>
          <span class="valor">{{ formatarData(caixaAtual?.dataHoraAbertura) }}</span>
        </div>
        <div class="info-item">
          <span class="label">Usu√°rio:</span>
          <span class="valor">{{ caixaAtual?.usuarioNome || 'N/A' }}</span>
        </div>
      </div>
      
      <div class="acoes">
        <button 
          type="button"
          class="btn btn-danger" 
          (click)="irParaFechamento()">
          üîí Ir para Fechamento de Caixa
        </button>
      </div>
    </div>
  </div>
  
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <!-- FORMUL√ÅRIO DE ABERTURA -->
  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div *ngIf="!caixaAberto && !carregando" class="abertura-caixa-card">
    <div class="card-header">
      <h2>üîì Abrir Novo Caixa</h2>
      <p class="subtitle">{{ dataHoraAtual | date:'dd/MM/yyyy HH:mm' }}</p>
    </div>
    
    <div class="card-body">
      <form (ngSubmit)="abrirCaixa()" #formAbertura="ngForm">
        
        <!-- TURNO -->
        <div class="form-group">
          <label for="turno" class="form-label">
            <span class="icon">üïê</span>
            Turno *
          </label>
          <select
            id="turno"
            name="turno"
            class="form-control"
            [(ngModel)]="turnoSelecionado"
            required
            [disabled]="carregando"
          >
            <option *ngFor="let t of turnos" [value]="t.valor">
              {{ t.label }}
            </option>
          </select>
        </div>
        
        <!-- VALOR ABERTURA -->
        <div class="form-group">
          <label for="valorAbertura" class="form-label">
            <span class="icon">üíµ</span>
            Valor de Abertura (opcional)
          </label>
          <input
            type="number"
            id="valorAbertura"
            name="valorAbertura"
            class="form-control"
            [(ngModel)]="valorAbertura"
            placeholder="0,00"
            step="0.01"
            min="0"
            [disabled]="carregando"
          />
          <small class="form-hint">Valor em dinheiro no caixa</small>
        </div>
        
        <!-- OBSERVA√á√ïES -->
        <div class="form-group">
          <label for="observacoes" class="form-label">
            <span class="icon">üìù</span>
            Observa√ß√µes (opcional)
          </label>
          <textarea
            id="observacoes"
            name="observacoes"
            class="form-control"
            [(ngModel)]="observacoes"
            placeholder="Digite observa√ß√µes sobre a abertura do caixa"
            rows="3"
            maxlength="500"
            [disabled]="carregando"
          ></textarea>
          <small class="form-hint">{{ observacoes.length }}/500 caracteres</small>
        </div>
        
        <!-- BOT√ïES -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="limparFormulario()"
            [disabled]="carregando"
          >
            üîÑ Limpar
          </button>
          
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="carregando || !formAbertura.valid"
          >
            <span *ngIf="!carregando">‚úÖ Abrir Caixa</span>
            <span *ngIf="carregando">‚è≥ Abrindo...</span>
          </button>
        </div>
        
      </form>
    </div>
  </div>
  
</div>